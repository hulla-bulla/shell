echo "[blom profile]"

eval `ssh-agent`

SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

source $SCRIPT_DIR/_display.sh


# general
ask_to_continue() {
    while true; do
        read -p "Do you want to continue? (y/n): " choice
        case "$choice" in
            y|Y ) echo "Continuing..."; return 0;;
            n|N ) echo "Exiting..."; return 1;;
            * ) echo "Please enter y or n.";;
        esac
    done
}

# git
function commit () {
    commit_temp_path="~/.tmp/commit_msg"
    mkdir -p $commit_temp_path
   
    git add .

    #check if anything to commit
    if [[ -z $(git diff HEAD) ]];then
        
        echo "Create a humble, concise, clear, professional commit message in the voice of a senior developer. Write a oneliner what overall happened in the commit. The commit message should be with bulletpoints unicode bullets â€¢, one on each line of course and by this i mean that i want \n between each bullet point as i'm writing this in bash. If the commit changes are very short, skip the bullet points and only do the oneliner.  Comment about the implemented tests if any. If no tests added then dont comment about tests. When writing back to me, ONLY give me the commit message without anything else. I dont want any greeting or certanly! or similar at the end or beginning of the return message to me. I only want the commit message as I will be copying it straight into a git commit without editing. The commit message should only be based on this git diff: \n$(git diff HEAD)" | sgpt > $commit_temp_path

        vim $commit_temp_path
    fi
    
    print_sep
    
    echo "Commit message:"
    cat $commit_temp_path
    ask_to_continue
    
    print_sep    
    
    git commit -m "$(cat /tmp/commit_msg)"; 
    
    echo "cleaning up"
    rm $commit_temp_path
    rm $commit_temp_path.swp


} 

alias cm='commit'
alias cmp='commit && git push'
alias lg='git log'

alias source-bash=". ~/.bashrc"
alias sb="source-bash"

# gitlab

function gissues () {
    if [ -z "$1" ]; then
        echo "Need group number"
        return 1
    fi
    glab api "/groups/$1/issues" | jq -r '.[] | "###############################################################\n\n\(.web_url)\n\(.title)\n\(.description)\n"'
}
